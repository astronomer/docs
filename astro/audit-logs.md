---
title: 'Export Astro audit logs'
id: astro-audit-logs
sidebar_label: Export audit logs
---

:::caution

This feature is in [Public Preview](https://docs.astronomer.io/astro/feature-previews).

:::

Astro audit logs record Astro control plane administrative activities and events. You can use the audit logs to determine who did what, where, and when. You can also use audit logs to ensure your Organization is meeting its security and regulatory requirements. For example, you can use audit logs to determine when users were added to your Organization or to individual Workspaces.

## Export audit logs

Audit logs are retained for 90 days. Organization Owner permissions are required to export audit logs. 

1. In the Cloud UI, click the **Settings** tab.

2. Select the number days of audit data to export in the **Audit Logs** area and then click **Export**.

    The extracted audit log data is saved as a JSON file in your `downloads` directory with the default filename `<astro-organization-name>-logs-<number-of-days>-days-<date>.json`.

You can also export logs using the Astro CLI.

1. Run the following command to enable the feature:

    ```sh
    astro config set -g beta.audit_logs true
    ```

2. Run the following command to export audit logs as a GZIP file to your current directory:

    ```sh
    astro organization audit-logs export --organization-name="<your-organization-name>"
    ```

## Reference: Available audit log data

The following categories of event data are available in the audit log:

- API events: The data generated by user actions in the Cloud UI, Astro CLI, or from internal processing actions in the Astro control plane.
- Airflow UI access: The data generated when users access the Airflow UI.
- Astronomer container registry access: The data generated when users access the Astronomer container registry with the Astro CLI.

The audit log file is provided as a newline delimited JSON (NDJSON) file. Every entry in the audit log file corresponds to an event, and event attributes provide additional information about each event. 

### Common fields

The following table lists the common fields shared by all three categories of event data.

| Field  | Description                                          |
| ------- | ---------------------------------------------------- |
| `subjectId` | A unique identifier that identifies the initiator of the request. The value can be user ID or an API key. |
| `subjectType` | A unique identifier that identifies the subject of the request. The value can be `USER` or `SERVICEKEY`. |
| `organizationId` | A unique identifier that identifies your organization. This is the value displayed in the Cloud UI **Settings** page. |
| `timestamp` | The date and time the event occurred. |
| `sourceIp` | The IP address of the originating request. |
| `userAgent` | The application used to make the request. |

### API event fields

Audit log events can be generated from the v1 API or the v2 API. Each API generates different fields for the same actions, and your audit log might include events from both APIs. Audit log events for the v1 API are expected to decline as Astronomer transitions to the v2 API. 

#### v1 API event fields

The following table lists the fields that are unique to v1 API events.

| Field  | Description                                          |
| ------- | ---------------------------------------------------- |
| `operationName` | The name of the API event. For example, `createUserInvite` or `workspaceCreate`. |
| `graphqlClientName` | The type of client making the request. The values are `cloud-ui` or `cli`. |
| `requestInput` | The input for the API request. |
| `requestBody` | Raw graphQL for the event. |
| `correlationId` | A unique identifier for the request. |

The following table maps some common `operationName` attributes to their corresponding `requestInput` attributes. 

| Event | `operationName` attribute                                          | `requestInput` attributes                   |
| ------- | ---------------------------------------------------- | --------------------------------- |
| A new Deployment is created. | `createDeployment` | `label`, `workspaceId` |
| A Deployment is updated. | `updateDeployment` | `deploymentSpec` |
| A Deployment variable is updated. | `updateDeploymentVariables` | `isSecret`, `key` |
| An API key is created for a Deployment. | `createDeploymentApiKey` | `deploymentId`, `role` |
| An API key is deleted for a Deployment. | `deleteDeploymentApiKey` | `id` |
| The code for a Deployment is updated. | `ImageCreate` | `deploymentId` |

#### v2 API event fields 

The following table lists the fields that are unique to v2 API events.

| Field  | Description                                          |
| ------- | ---------------------------------------------------- |
| `path` | The path to the invoked REST API. |
| `method` | The HTTP request type sent to REST API. |
| `requestBody` | The parameters passed as input to the API call. |
| `response status` | The HTTP response status code. |
| `requestId` | A unique identifier for the request. |

The following table maps some common `path` attributes to their corresponding `requestBody` attributes. 

| Event | `path` attribute                                          | `requestBody` attributes                   |
| ------- | ---------------------------------------------------- | --------------------------------- |
| A Organization is created.   | `/v1alpha1/organizations` | `metadata`, `name` |
| A Organization is updated.   | `/v1alpha1/organizations/{orgShortNameId}` | `billingEmail`, `isScimEnabled`, `metadata`, `name` |
| A managed domain for an Organization is created.   | `/v1alpha1/organizations/{orgShortNameId}/domains` | `enforcedLogins` `name` |
| A managed domain for an Organization is updated.   | `/v1alpha1/organizations/{orgShortNameId}/domains/{domainId}` | `enforcedLogins` |
| A managed domain for an Organization is deleted.   | `/v1alpha1/organizations/{orgShortNameId}/domains/{domainId}` | |
| A managed domain for an Organization is verified.   | `/v1alpha1/organizations/{orgShortNameId}/domains/{domainId}/verify` | |
| SSO Bypass Key for an Organization is created.   | `/v1alpha1/organizations/{orgShortNameId}/sso-bypass-key` | |
| SSO Bypass Key for an Organization is deleted.   | `/v1alpha1/organizations/{orgShortNameId}/sso-bypass-key` | |
| SSO Connection for an Organization is created.   | `/v1alpha1/organizations/{orgShortNameId}/sso-connections` | |
| SSO Connection for an Organization is updated.   | `/v1alpha1/organizations/{orgShortNameId}/sso-connections/{connectionId}` | |
| SSO Connection for an Organization is deleted.   | `/v1alpha1/organizations/{orgShortNameId}/sso-connections/{connectionId}` | |
| A new user is invited to an Organization.   | `/v1alpha1/organizations/{orgShortNameId}/invites` | `inviteEmail`, `role` |
| A invite to the Organization is updated.   | `/v1alpha1/users/self/invites/{inviteId}` | `inviteStatus` |
| A invite to the Organization is deleted.   | `/v1alpha1/organizations/{orgShortNameId}/invites/{inviteId}` | |
| A user is deleted from an organization.  | `/v1alpha1/organizations/{orgShortNameId}/users/{userId}` | |
| A user is assigned a new organization role.  | `/v1alpha1/organizations/{orgShortNameId}/users/{userId}/role` | `role` |
| A user is assigned a new workspace role.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/users/{userId}/role` | `role`|
| A user is removed from a workspace.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/users/{userId}` | |
| A Workspace is created.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces` | `apiKeyOnlyDeploymentsDefault`, `description`, `name` |
| A Workspace is updated.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}` | `apiKeyOnlyDeploymentsDefault`, `description`, `name` |
| A Workspace is deleted. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}` | |
| A deployment is transferred to another workspace.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/deployments/{deploymentId}` | `workspaceIdTarget` |
| An AWS cluster is created.  | `/v1alpha1/organizations/{orgShortNameId}/clusters/aws` | `dbInstanceType`, `k8sTags`, `name`, `nodePools`, `templateVersion` |
| An AWS cluster is updated.  | `/v1alpha1/organizations/{orgShortNameId}/clusters/aws/{clusterId}` | `dbInstanceType`, `k8sTags`, `name`, `nodePools`, `templateVersion` |
| A Azure cluster is created.  | `/v1alpha1/organizations/{orgShortNameId}/clusters/azure` | `dbInstanceType`, `k8sTags`, `name`, `nodePools`, `providerAccount`, `region`, `templateVersion`, `tenantId`, `type`, `vpcSubnetRange` |
| A Azure cluster is updated.  | `/v1alpha1/organizations/{orgShortNameId}/clusters/azure/{clusterId}` | `dbInstanceType`, `k8sTags`, `name`, `nodePools`, `templateVersion`, |
| A GCP cluster is created.  | `/v1alpha1/organizations/{orgShortNameId}/clusters/gcp` | `dbInstanceType`, `k8sTags`, `name`, `nodePools`, `podSubnetRange` `providerAccount`, `region`, `servicePeeringRange`, `serviceSubnetRange`, `templateVersion`, `type`, `vpcSubnetRange` |
| A GCP cluster is updated.  | `/v1alpha1/organizations/{orgShortNameId}/clusters/gcp/{clusterId}` | `dbInstanceType`, `k8sTags`, `name`, `nodePools`, `templateVersion` |
| A cluster is deleted.  | `/v1alpha1/organizations/{orgShortNameId}/clusters/{clusterId}` | |
| An Organization API token is created.  | `/v1alpha1/organizations/{orgShortNameId}/api-tokens` | `description`, `name`, `role`, `tokenExpiryPeriodInDays` |
| An Organization API token is updated.  | `/v1alpha1/organizations/{orgShortNameId}/api-tokens/{apiTokenId}` | `description`, `name`, `roles` |
| An Organization API token is deleted.  | `/v1alpha1/organizations/{orgShortNameId}/api-tokens/{apiTokenId}` | |
| An Organization API token is rotated.  | `/v1alpha1/organizations/{orgShortNameId}/api-tokens/{apiTokenId}/rotate` | |
| A Workspace API token is created.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/api-tokens` | `description`, `name`, `role`, `tokenExpiryPeriodInDays` |
| A Workspace API token is updated.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/api-tokens/{apiTokenId}` | `description`, `name`, `role` |
| A Workspace API token is deleted.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/api-tokens/{apiTokenId}` | |
| A Workspace API token is rotated.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/api-tokens/{apiTokenId}/rotate` | |
| A Team is created.  | `/v1alpha1/organizations/{orgShortNameId}/teams` | `description`, `name`, `memberIds` |
| A Team is updated.  | `/v1alpha1/organizations/{orgShortNameId}/teams/{teamId}` | `description`, `name` |
| A Team is deleted.  | `/v1alpha1/organizations/{orgShortNameId}/teams/{teamId}` | |
| A user is added to a Team.  | `/v1alpha1/organizations/{orgShortNameId}/teams/{teamId}/members` | `memberIds` |
| A user is removed from a Team  | `/v1alpha1/organizations/{orgShortNameId}/teams/{teamId}/members` | |
| A Team is removed from a Workspace.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/teams/{teamId}` | |
| A Team's role in a Workspace is updated.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/teams/{teamId}/role` | `role` |
| A DAG is updated.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/runtimes/{runtimeId}/pipelines/{pipelineName}` | `isPaused` |
| A DAG run is created.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/runtimes/{runtimeId}/pipelines/{pipelineName}/runs` | `logicalDate` |
| A DAG run has its state updated.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/runtimes/{runtimeId}/pipelines/{pipelineName}/runs/{pipelineRunId}` | `state` |
| A DAG run is cleared.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/runtimes/{runtimeId}/pipelines/{pipelineName}/runs/{pipelineRunId}/clear` | `isDryRun` |
| A task instance for a DAG run is cleared.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/runtimes/{runtimeId}/pipelines/{pipelineName}/clear-task-instances` | `endDate`, `includeDownstream`, `includeFuture`, `includeParentPipelines`, `includePast`, `includeSubPipelines`, `includeUpstream`, `onlyFailed`, `onlyRunning`, `pipelineRunId`, `resetPipelineRuns`, `startDate`, `taskIds` |
| A task instance's state is set.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/runtimes/{runtimeId}/pipelines/{pipelineName}/runs/{pipelineRunId}/tasks/{taskId}` | `state` |
| A task instance's state is updated.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/runtimes/{runtimeId}/pipelines/{pipelineName}/update-task-instances-state` | `executionDate`, `includeDownstream`, `includeFuture`, `includePast`, `includeUpstream`, `isDryRun`, `pipelineRunId`, `state`, `taskId` |

Use your analytics or audit tool to view additional attribute mapping information. 

### Airflow UI access event fields

The following table lists the fields that are unique to Airflow UI access events.

| Field  | Description                                          |
| ------- | ---------------------------------------------------- |
| `targetUrl` | The URL for the canonical name record in the Airflow webserver that runs in the Astro control dataplane. For example, `https://cl8gwrnw601f10tyxhgrhaayw.astronomer.run`.  |
| `path` | The relative path of the page being accessed. For example, `/dzl9chy4/configuration`.  |
| `method` | The HTTP method for the request. |

### Astronomer container registry access event fields

The following table lists the fields that are unique to Astronomer container registry access events.

| Field  | Description                                          |
| ------- | ---------------------------------------------------- |
| `deploymentId` | A unique identifier that identifies the Deployment on which the event occurred. |
| `path` | The path to the image in the registry. |
| `method` | The HTTP method for the request. |

### Astro CLI access event fields

The following table lists the fields that are unique to Astro CLI access events.

| Field  | Description                                          |
| ------- | ---------------------------------------------------- |
| `astroClient` | A unique identifier for the API client. `cli` means the requst came from the Astro CLI. |
| `astroClientVersion` | A unique identifier for the API client version. |
| `userAgent` | A unique identifier for the API client type and version. `astro-cli/1.15.1` means the request came from version 1.15.1 of the Astro CLI.|

### Cloud IDE API event fields

The Astro Cloud IDE uses the same unique events as the v2 API.

The following table maps some common `path` attributes to their corresponding `requestBody` attributes. 

| Event | `path` attribute                                          | `requestBody` attributes                   |
| ------- | ---------------------------------------------------- | --------------------------------- |
| An pipeline is created.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/pipelines` | `description`, `name`, `scheduleInterval`, `startDate`, `timezone` |
| A pipeline is updated.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/pipelines/{pipelineId}` | `cellPositions`, `description`, `imports` `name`, `scheduleInterval`, `startDate`, `timezone` |
| A pipeline is deleted.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/pipelines/{pipelineId}` | |
| A project is created.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects` | `description`, `name` |
| A project is updated.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}` | `connections`, `git`, `includes`, `requirements`, `variables`, `description`, `name` |
| A project is deleted.   | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}` | |
| A branch for a project is created. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/git/branches` | `from`, `name` |
| A commit for a project branch is created. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/git/commits` | `branch`, `message`, `paths` |
| A connection is tested in a project. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/test-connection` | `extra`, `host`, `id`, `login`, `password`, `port`, `schema`, `type` |
| A custom operator cell type is created. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/cell-types` | `behavior`, `configs`, `datatype`, `display`, `name` |
| A custom operator cell type is updated. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/cell-types/{cellTypeName}` | `behavior`, `configs`, `datatype`, `display`, `name` |
| A custom operator cell type is deleted. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/cell-types/{cellTypeName}` | |
| A custom operator cell type is tested. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/validate-cell-type` | `behavior`, `configs`, `datatype`, `display`, `name` |
| A cell instance is created. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/pipelines/{pipelineId}/cells` | `dependenciesExplicit`, `name`, `type`, `typeConfigForms`, `typeConfigs` |
| A cell instance is updated. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/pipelines/{pipelineId}/cells/{cellId}` | `dependenciesExplicit`, `name`, `type`, `typeConfigForms`, `typeConfigs` |
| A cell instance is deleted. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/pipelines/{pipelineId}/cells/{cellId}` | |
| A cell instance is duplicated. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/pipelines/{pipelineId}/cells/{cellId}/duplicate` | `name` |
| A cell run is triggered. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/pipelines/{pipelineId}/cells/{cellId}/runs` | `pipelineSessionId` |
| A pipeline run is triggered. | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/projects/{projectId}/pipelines/{pipelineId}` | `pipelineSessionId` |

