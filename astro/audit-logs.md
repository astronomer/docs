---
title: 'Astro audit logs'
id: astro-audit-logs
---

:::caution

This feature is in [Private Preview](https://docs.astronomer.io/astro/feature-previews).

:::

Astro audit logs record Astro control plane administrative activities and events. You can use the audit logs to determine who did what, where, and when. You can also use audit logs to ensure your organization is meeting its security and regulatory requirements. For example, you can use audit logs to determine when users were added to your organization or to individual Workspaces.

### Available audit log data

The following categories of event data are available in the audit log:

- API events: The data generated by user actions in the Cloud UI, Astro CLI, or from internal processing actions in the Astro control plane.
- Airflow UI access: The data generated when users access the Airflow UI.
- Astronomer container registry access: The data generated when users access the Astronomer container registry with the Astro CLI.

The audit log file is provided as a newline delimited JSON (NDJSON) file. Every entry in the audit log file corresponds to an event, and event attributes provide additional information about each event. 

#### Common fields

The following table lists the common fields shared by all three categories of event data.

| Field  | Description                                          |
| ------- | ---------------------------------------------------- |
| `subjectId` | A unique identifier that identifies the initiator of the request. The value can be user ID or an API key. |
| `subjectType` | A unique identifier that identifies the subject of the request. The value can be `USER` or `SERVICEKEY`. |
| `organizationId` | A unique identifier that identifies your organization. This is the value displayed in the Cloud UI **Settings** page. |
| `timestamp` | The date and time the event occurred. |
| `sourceIp` | The IP address of the originating request. |
| `userAgent` | The application used to make the request. |

#### API event fields

Audit log events can be generated from the v1 API or the v2 API. Each API generates different fields for the same actions, and your audit log might include events from both APIs. Audit log events for the v1 API are expected to decline as Astronomer transitions to the v2 API. 

##### v1 API event fields
The following table lists the fields that are unique to v1 API events.

| Field  | Description                                          |
| ------- | ---------------------------------------------------- |
| `operationName` | The name of the API event. For example, `createUserInvite` or `workspaceCreate`. |
| `graphqlClientName` | The type of client making the request. The values are `cloud-ui` or `cli`. |
| `requestInput` | The input for the API request. |
| `requestBody` | Raw graphQL for the event. |
| `correlationId` | A unique identifier for the request. |

The following table maps some common `operationName` attributes to their corresponding `requestInput` attributes. 

| Event | `operationName` attribute                                          | `requestInput` attributes                   |
| ------- | ---------------------------------------------------- | --------------------------------- |
| The Organization is updated. | `updateOrganization` | `id`, `name` |
| A new user is invited to an organization.   | `createUserInvite` | `inviteeEmail`, `role` |
| A user has accepted their invite to an organization. | `updateUserInvite` |
| A user is deleted from an organization.  | `deleteUserInvite` | `inviteId` |
| A user is assigned a new role.  | `assignUserOrganizationRole` | `role`, `userId` |
| A user is removed from an organization.  | `deleteOrganizationUser` | `organizationId`, `userId` |
| A Workspace is created.  | `createWorkspace` | `label`, `organizationId` |
| A Workspace is updated.  | `updateWorkspace` | `label`, `id` |
| A Workspace is deleted.  | `deleteWorkspace` | `id` |
| A user is added to a Workspace, or a user role is updated. | `assignUserWorkspaceRole` | `email`, `role`, `workspaceId` |
| A user is removed from a workspace. | `deleteUserWorkspaceRole` | `userId`, `workspaceId` |
| A new Deployment is created. | `createDeployment` | `label`, `workspaceId` |
| A Deployment is updated. | `updateDeployment` | `deploymentSpec` |
| A Deployment variable is updated. | `updateDeploymentVariables` | `isSecret`, `key` |
| An API key is created for a Deployment. | `createDeploymentApiKey` | `deploymentId`, `role` |
| An API key is deleted for a Deployment. | `deleteDeploymentApiKey` | `id` |
| The code for a Deployment is updated. | `ImageCreate` | `deploymentId` |

##### v2 API event fields 

The following table lists the fields that are unique to v2 API events.

| Field  | Description                                          |
| ------- | ---------------------------------------------------- |
| `path` | The path to the invoked REST API. |
| `method` | The HTTP request type sent to REST API. |
| `requestBody` | The parameters passed as input to the API call. |
| `response status` | The HTTP response status code. |
| `requestId` | A unique identifier for the request. |

The following table maps some common `path` attributes to their corresponding `requestBody` attributes. 

| Event | `path` attribute                                          | `requestBody` attributes                   |
| ------- | ---------------------------------------------------- | --------------------------------- |
| A new user is invited to an organization.   | `/v1alpha1/organizations/{orgShortNameId}/invites` | `inviteeEmail`, `role` |
| A invite to the organization is updated.   | `/v1alpha1/organizations/{orgShortNameId}/invites/{inviteId}` | |
| A user is deleted from an organization.  | `/v1alpha1/organizations/{orgShortNameId}/users/{userId}` | |
| A user is assigned a new organization role.  | `/v1alpha1/organizations/{orgShortNameId}/users/{userId}/role` | `role` |
| A user is assigned a new workspace role.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/users/{userId}/role` | `role`|
| A user is removed from a workspace.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/users/{userId}` | |
| A deployment is transferred to another workspace.  | `/v1alpha1/organizations/{orgShortNameId}/workspaces/{workspaceId}/deployments/{deploymentId}` | `workspaceIdTarget` |


Use your analytics or audit tool to view additional attribute mapping information. 

#### Airflow UI access event fields

The following table lists the fields that are unique to Airflow UI access events.

| Field  | Description                                          |
| ------- | ---------------------------------------------------- |
| `targetUrl` | The URL for the canonical name record in the Airflow webserver that runs in the Astro control dataplane. For example, `https://cl8gwrnw601f10tyxhgrhaayw.astronomer.run`.  |
| `path` | The relative path of the page being accessed. For example, `/dzl9chy4/configuration`.  |
| `method` | The HTTP method for the request. |

#### Astronomer container registry access event fields

The following table lists the fields that are unique to Astronomer container registry access events.

| Field  | Description                                          |
| ------- | ---------------------------------------------------- |
| `deploymentId` | A unique identifier that identifies the Deployment on which the event occurred. |
| `path` | The path to the image in the registry. |
| `method` | The HTTP method for the request. |

### Export audit logs

 Audit logs are retained for 90 days. Organization Owner permissions are required to export audit logs. 

 1. In the Cloud UI, click the **Settings** tab.

 2. Select the number days of audit data to export in the **Audit Logs** area and then click **Export**.

    The extracted audit log data is saved as a JSON file in your `downloads` directory with the default filename `<astro-organization-name>-logs-<number-of-days>-days-<date>.json`.


You can also export logs using the Astro CLI.

1. Run the following command to enable the feature:

    ```sh
    astro config set -g beta.audit_logs true
    ```

2. Run the following command to export audit logs as a GZIP file to your current directory:

    ```sh
    astro organization audit-logs export --organization-name="<your-organization-name>"
    ```

    
