---
sidebar_label: 'Migrate to Astro from MWAA'
title: 'Migrating to Astro from MWAA'
id: migrate-mwaa
description: Get started on Astro by migrating your Airflow code from Amazon Managed Workflows for Apache Airflow (MWAA).
---

import Intro from './migration-partials/intro.mdx';
import Prereq from './migration-partials/prereqs.mdx';
import Requirements from './migration-partials/requirements.mdx';
import Starship from './migration-partials/starship.mdx';
import Usage from './migration-partials/starship_usage.mdx';
import Workspaces from './migration-partials/workspaces.mdx';
import Deployments from './migration-partials/deployments.mdx';
import RuntimeVersionInfo from './migration-partials/runtime_version_info.mdx'
import DAGs from './migration-partials/directory_setup.mdx';

This is where you'll find instructions for migrating to Astro from another managed Airflow environment. This guide will
cover migrating an Airflow Instance from [Amazon Managed Workflows for Apache Airflow (MWAA)](https://docs.aws.amazon.com/mwaa/latest/userguide/what-is-mwaa.html)

<Intro />

## Prerequisites

<Prereq/>

### Requirements

<Requirements />

You can additionally utilize the `aws` CLI to expedite some steps in this guide.

## Prepare Source and Setup Astro Airflow

### Step 1: Install Astronomer Starship
<Starship />

#### Starship Compatability Matrix

| Source Airflow      | Starship Plugin | Starship Operator |
|---------------------|-----------------|-------------------|
| Airflow 1.x         | ❌               | ❌                 |
| MWAA v2.0.2         |                 | ✔️️               |
| MWAA v2.2.2         | ✔️️             |                   |
| MWAA v2.4.3         | ✔️️             |                   |

#### Installation
To install Starship to your MWAA instance, you'll need to edit the `requirements.txt` file in your S3 Bucket.
You can find more [detailed instructions here.](https://docs.aws.amazon.com/mwaa/latest/userguide/best-practices-dependencies.html#best-practices-dependencies-different-ways)

1. Download your existing `requirements.txt` file from S3
2. Add `astronomer-starship` on a new line in your `requirements.txt` file
3. Re-upload the file to your S3 bucket
4. Edit your Airflow Environment to refer to the new version of this file.

:::cli
You can accomplish this easily with the `aws` CLI, in a terminal:

Modify these values:
```sh
export MWAA_NAME="MWAA"
export MWAA_BUCKET="MWAA BUCKET"
```
then, in a terminal, run:
```shell
aws s3 cp "s3://$MWAA_BUCKET/requirements.txt" requirements.txt
echo 'astronomer-starship' >> requirements.txt
aws s3 cp requirements.txt "s3://$MWAA_BUCKET/requirements.txt"
aws mwaa update-environment "$MWAA_NAME" --requirements-s3-object-version="$(aws s3api head-object --bucket=$MWAA_BUCKET --key=requirements.txt --query="VersionId")"
```
:::

We will cover usage of the Starship migration utility later in this document

### Step 2: Create Astro Workspace

<Workspaces />


### Step 3: Create Astro Deployment

<Deployments />

## Migrate Airflow Metadata
In this step we will migrate Airflow Metadata with Starship from Source Environment

### Step 4: Use Starship to Migrate Airflow Connections and Variables
<Usage />

## Migrate DAGs
### Step 5: Initialize new repository skeleton
<DAGs />

### Step 6: Copy core Airflow code
1. Edit `Dockerfile` to match Astro Runtime version to customer’s Source environment Airflow version
    <RuntimeVersionInfo />
    :::info
    The `Dockerfile` creates the backing environment that all of your Airflow components run in.
    You can customize that in a variety of ways, and might
    modify it to copy special things like certificates or keys to be available in your environment.

    You shouldn't need to modify your `Dockerfile` beyond this, for the purposes of this migration, but may in the future.
    :::
2. Add `requirements.txt` , as needed.
    :::cli
    You can do this with the CLI
    :::

3. Copy `/dags` folder from source control or blob storage
    :::cli
    You can do this with the CLI
    :::


### Step 7: Copy accessory Airflow code
Following recommended [project structure](https://docs.astronomer.io/learn/managing-airflow-code#project-structure):

- Copy `/plugins` folder from source control or blob storage, as needed
:::cli
You can do this with the CLI
:::
